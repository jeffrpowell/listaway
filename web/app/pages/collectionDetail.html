{{define "all"}}
<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold">{{.Collection.Name}}</h1>
      <p class="text-gray-600 mt-1">{{if .Collection.Description.Valid}}{{.Collection.Description.String}}{{end}}</p>
    </div>

    <div class="flex space-x-2 mt-4 md:mt-0">
      <a href="/collections/{{.Collection.Id}}/edit" class="btn btn-outline">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Edit Collection
      </a>
      {{if .Collection.ShareCode.Valid}}
      <button class="btn btn-outline" onclick="copyShareLink('{{.Collection.ShareCode.String}}')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
        </svg>
        Share Collection
      </button>
      {{else}}
      <button class="btn btn-outline" onclick="publishCollection({{.Collection.Id}})">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
        </svg>
        Publish Collection
      </button>
      {{end}}
    </div>
  </div>

  <div class="mb-8">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Lists in this Collection</h2>
      <button class="btn btn-primary btn-sm" onclick="openAddListModal()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add List
      </button>
    </div>

    <div class="overflow-x-auto">
      <table class="table w-full">
        <thead>
          <tr>
            <th>List Name</th>
            <th>Description</th>
            <th class="w-32">Actions</th>
          </tr>
        </thead>
        <tbody id="listTable">
          {{range .ListsInCollection}}
          {{$listId := .ListId}}
          <tr>
            <script>
              // Set data attributes via JavaScript to avoid minifier lowercasing
              document.currentScript.parentElement.setAttribute('data-list-id', '{{$listId}}');
            </script>
            <td>
              <a href="/list/{{.ListId}}" class="font-medium text-blue-600 hover:text-blue-800">{{.Name}}</a>
            </td>
            <td>{{if .Description.Valid}}{{.Description.String}}{{end}}</td>
            <td>
              <div class="flex space-x-1">
                <a href="/list/{{.ListId}}" class="btn btn-xs btn-ghost" title="View List">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </a>
                <button class="btn btn-xs btn-ghost text-red-500" onclick="removeListFromCollection({{.ListId}})"
                  title="Remove from Collection">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          {{else}}
          <tr>
            <td colspan="4" class="text-center py-8">
              <p class="text-gray-500">No lists in this collection yet.</p>
              <button class="btn btn-sm btn-primary mt-2" onclick="openAddListModal()">Add Your First List</button>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add List Modal -->
<div id="addListModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">Add Lists to Collection</h3>
    <p class="py-2">Select lists to add to this collection:</p>
    <div class="py-4 max-h-60 overflow-y-auto" id="availableListsContainer">
      <div class="space-y-2">
        {{range .AvailableLists}}
        <div class="form-control">
          <label class="label cursor-pointer justify-start">
            <input type="checkbox" class="checkbox checkbox-primary mr-2" value="{{.Id}}" />
            <span class="label-text">{{.Name}}</span>
          </label>
          {{if .Description.Valid}}<p class="text-xs text-gray-500 ml-6">{{.Description.String}}</p>{{end}}
        </div>
        {{end}}
        {{if eq (len .AvailableLists) 0}}
        <div class="text-center text-gray-500 py-4">
          <p>No available lists to add</p>
        </div>
        {{end}}
      </div>
    </div>
    <div class="modal-action">
      <button class="btn" onclick="closeAddListModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addSelectedLists()">Add Selected</button>
    </div>
  </div>
</div>

<!-- Share Link Modal -->
<div id="shareLinkModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">Share Collection</h3>
    <p class="py-4">Share this link to give others access to view this collection:</p>
    <div class="form-control">
      <div class="input-group">
        <input id="shareLink" type="text" class="input input-bordered flex-1" readonly />
        <button class="btn" onclick="copyToClipboard()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-2M8 5a2 2 0 002-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
          </svg>
          Copy
        </button>
      </div>
    </div>
    <div class="modal-action">
      <button class="btn" onclick="closeShareModal()">Close</button>
    </div>
  </div>
</div>
{{end}}